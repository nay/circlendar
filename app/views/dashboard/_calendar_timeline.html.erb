<!-- 2ヶ月カレンダー -->
<div class="bg-white shadow sm:rounded-lg p-4 mb-8">
  <h2 class="text-base font-medium text-gray-900 mb-3">今後2ヶ月の予定</h2>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <% calendar_days.group_by { |day| day[:date].beginning_of_month }.each do |month_start, days_in_month| %>
      <div>
        <!-- 月のヘッダー -->
        <div class="text-center text-sm font-medium text-gray-900 mb-2">
          <%= month_start.strftime('%Y年%-m月') %>
        </div>

        <!-- カレンダーグリッド -->
        <div class="border border-gray-200 rounded overflow-hidden">
          <!-- 曜日ヘッダー -->
          <div class="grid grid-cols-7 bg-gray-50 border-b border-gray-200">
            <div class="text-center text-xs py-1 text-red-600">日</div>
            <div class="text-center text-xs py-1 text-gray-700">月</div>
            <div class="text-center text-xs py-1 text-gray-700">火</div>
            <div class="text-center text-xs py-1 text-gray-700">水</div>
            <div class="text-center text-xs py-1 text-gray-700">木</div>
            <div class="text-center text-xs py-1 text-gray-700">金</div>
            <div class="text-center text-xs py-1 text-blue-600">土</div>
          </div>

          <!-- 日付グリッド -->
          <div class="grid grid-cols-7">
            <!-- 月初の空白セル -->
            <% (month_start.wday).times do %>
              <div class="h-8 border-t border-r border-gray-100"></div>
            <% end %>

            <!-- 日付セル -->
            <% days_in_month.each do |day_data| %>
              <%
                date = day_data[:date]
                event = day_data[:event]
                attendance = day_data[:attendance]
                is_today = date == Date.current

                # 日付の文字色
                text_color = if date.wday == 0
                  'text-red-600'
                elsif date.wday == 6
                  'text-blue-600'
                else
                  'text-gray-900'
                end

                # 背景色（土日のみ）
                bg_color = (date.wday == 0 || date.wday == 6) ? 'bg-blue-50' : 'bg-white'

                # 今日の強調
                if is_today
                  bg_color = 'bg-blue-100'
                end
              %>

              <div class="h-8 border-t border-r border-gray-100 <%= bg_color %> relative flex items-center justify-center">
                <!-- 練習会マーカー -->
                <% if event %>
                  <%
                    # マーカーの色
                    if attendance
                      case attendance.status
                      when "attending"
                        marker_color = "border-green-500 bg-green-100"
                      when "not_attending"
                        marker_color = "border-gray-400 bg-gray-100"
                      else # undecided
                        marker_color = "border-red-500 bg-red-100"
                      end
                    else
                      # 未回答
                      marker_color = "border-red-500 bg-red-100"
                    end
                  %>
                  <%= link_to edit_event_attendance_path(event), class: "w-6 h-6 rounded-full border #{marker_color} flex items-center justify-center hover:opacity-75" do %>
                    <span class="text-xs <%= text_color %> <%= is_today ? 'font-bold' : '' %>"><%= date.day %></span>
                  <% end %>
                <% else %>
                  <span class="text-xs <%= text_color %> <%= is_today ? 'font-bold' : '' %>"><%= date.day %></span>
                <% end %>
              </div>
            <% end %>

            <!-- 月末の空白セル -->
            <% (6 - days_in_month.last[:date].wday).times do %>
              <div class="h-8 border-t border-r border-gray-100"></div>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <!-- 凡例 -->
  <div class="mt-3 flex flex-wrap gap-3 text-xs text-gray-600">
    <div class="flex items-center gap-1">
      <div class="w-5 h-5 rounded-full border bg-red-100 border-red-500"></div>
      <span>未回答</span>
    </div>
    <div class="flex items-center gap-1">
      <div class="w-5 h-5 rounded-full border bg-green-100 border-green-500"></div>
      <span>参加</span>
    </div>
    <div class="flex items-center gap-1">
      <div class="w-5 h-5 rounded-full border bg-gray-100 border-gray-400"></div>
      <span>不参加</span>
    </div>
  </div>
</div>
